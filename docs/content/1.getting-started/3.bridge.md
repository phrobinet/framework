# Bridge

Exp√©rimentez les fonctionnalit√©s de Nuxt 3 sur des projets Nuxt 2 existants.

::alerte
Si vous d√©marrez un nouveau projet Nuxt 3, veuillez sauter cette section et aller √† [Installation de Nuxt 3](/getting-started/installation).<br>
Apprenez-en plus dans [Introduction](/getting-started/introduction).
::

::alert{type=warning}
Nuxt Bridge fournit des fonctionnalit√©s identiques √† Nuxt 3 ([docs](/docs/usage)) mais il y a quelques limitations, notamment que les composables `useAsyncData` et `useFetch` ne sont pas disponibles. Veuillez lire le reste de cette page pour plus de d√©tails.
::

Bridge est une couche de compatibilit√© avanc√©e qui vous permet d'exp√©rimenter la plupart des nouvelles fonctionnalit√©s de Nuxt 3 en installant et en activant simplement un module Nuxt.

En utilisant Nuxt Bridge, vous pouvez vous assurer que votre projet est (presque) pr√™t pour Nuxt 3 et avoir la meilleure exp√©rience de d√©veloppeur sans avoir besoin d'une r√©√©criture majeure ou risquer de casser des changements.

## Mise √† jour de Nuxt 2

Supprimez tout fil de verrouillage de paquetes (`package-lock.json` and `yarn.lock`) and use the latest `nuxt-edge`:

```diff [package.json]
- "nuxt": "^2.15.0"
+ "nuxt-edge": "latest"
```

Ensuite, r√©installez vos d√©pendances :

::code-group

```bash [Yarn]
yarn install
```

```bash [NPM]
npm install
```

::

::alert
Une fois l'installation termin√©e, assurez-vous que les versions de d√©veloppement et de production fonctionnent comme pr√©vu avant de poursuivre.
::

## Installer Nuxt Bridge

Installez `@nuxt/bridge-edge` comme une d√©pendance de d√©veloppement :

::code-group

```bash [Yarn]
yarn add --dev @nuxt/bridge@npm:@nuxt/bridge-edge
```

```bash [NPM]
npm install -D @nuxt/bridge@npm:@nuxt/bridge-edge
```

::

## Mettez √† jour vos scripts

Vous devrez aussi mettre √† jour vos scripts dans votre `package.json` pour refl√©ter le fait que Nuxt produira maintenant un serveur Nitro comme sortie de compilation.

### Nuxi

Nuxt 3 a introduit la nouvelle commande Nuxt CLI [`nuxi`](/getting-started/commands/). Mettez √† jour vos scripts comme suit pour profiter du meilleur support de Nuxt Bridge :

```diff
{
  "scripts": {
-   "dev": "nuxt",
+   "dev": "nuxi dev",
-   "build": "nuxt build",
+   "build": "nuxi build",
-   "start": "nuxt start",
+   "start": "node .output/server/index.mjs"
  }
}
```

### Cible statique

Si vous avez mis `target : 'static'` dans votre `nuxt.config` alors vous devez vous assurer que vous mettez √† jour votre script de construction pour √™tre `nuxi generate`.

```json [package.json]
{
  "scripts": {
    "build": "nuxi generate"
  }
}
```

### Cible du serveur

Pour toutes les autres situations, vous pouvez utiliser la commande `nuxi build`.

```json [package.json]
{
  "scripts": {
    "build": "nuxi build",
    "start": "node .output/server/index.mjs"
  }
}
```

## Mettre √† jour `nuxt.config`

Veuillez vous assurer d'√©viter toute syntaxe CommonJS telle que `module.exports`, `require` ou `require.resolve` dans votre fichier de configuration. Elle sera bient√¥t d√©pr√©ci√©e et non support√©e.

Vous pouvez utiliser `import` statique, `import()` dynamique et `export default` √† la place. L'utilisation de TypeScript en renommant le fichier `nuxt.config.ts` est √©galement possible et recommand√©e.

```ts [nuxt.config.js|ts]
import { defineNuxtConfig } from '@nuxt/bridge'

export default defineNuxtConfig({
  // Your existing configuration
})
```

## Mettre √† jour `tsconfig.json`

Si vous utilisez TypeScript, vous pouvez modifier votre `tsconfig.json` pour b√©n√©ficier des types Nuxt g√©n√©r√©s automatiquement :

```diff [tsconfig.json]
{
+ "extends": "./.nuxt/tsconfig.json",
  "compilerOptions": {
    ...
  }
}
```

::alert
Vous devrez peut-√™tre aussi ajouter `@vue/runtime-dom` en tant que devDependency si vous avez du mal √† faire fonctionner l'inf√©rence de type de mod√®le avec [Volar](https://marketplace.visualstudio.com/items?itemName=johnsoncodehk.volar).
::

## Migrer l'API de composition

Si vous utilisiez pr√©c√©demment `@vue/composition-api` ou `@nuxtjs/composition-api`, veuillez lire le [guide de migration de l'API de composition](/getting-started/bridge-composition-api).

### Migrer de CommonJS vers ESM

Nuxt 3 supporte nativement les modules TypeScript et ECMAScript. Veuillez consulter [Native ES Modules](/concepts/esm) pour plus d'informations et la mise √† jour.

## Supprimer les modules incompatibles et obsol√®tes

- Supprimez `@nuxt/content` (1.x). Une r√©√©criture pour nuxt 3 est pr√©vue (2.x).
- Supprimez `nuxt-vite` : Un pont permet la m√™me fonctionnalit√©
- Supprimez `@nuxt/typescript-build` : Le pont permet la m√™me fonctionnalit√©
- Supprimez `@nuxt/typescript-runtime` et `nuxt-ts` : Nuxt 2 a un support int√©gr√© du runtime
- Supprimez `@nuxt/nitro` : Bridge injecte la m√™me fonctionnalit√©
- Supprimez `@vue/composition-api` de vos d√©pendances ([guide de migration](/getting-started/bridge-composition-api)).
- Supprimez `@nuxtjs/composition-api` de vos d√©pendances (et de vos modules dans `nuxt.config`) ([guide de migration](/getting-started/bridge-composition-api)).

## Exclure de git le dossier Nitro construit

Ajoutez le dossier `.output` au fichier `.gitignore`.

## S'assurer que tout va bien

‚úîÔ∏è Essayez avec `nuxi dev` et `nuxi build` (ou `nuxi generate`) pour voir si tout se passe bien.

üêõ Quelque chose ne va pas ? Veuillez nous le faire savoir en cr√©ant un probl√®me. En outre, vous pouvez facilement d√©sactiver le pont en attendant :

```ts [nuxt.config.js|ts]
import { defineNuxtConfig } from '@nuxt/bridge'

export default defineNuxtConfig({
  bridge: false // Temporarily disable bridge integration
})
```

## Nouveau format des plugins (optionnel)

Vous pouvez maintenant migrer vers l'API des plugins de Nuxt 3, dont le format est l√©g√®rement diff√©rent de celui de Nuxt 2.

Les plugins prennent maintenant un seul argument (`nuxtApp`). Vous pouvez en savoir plus dans [la docs](/docs/directory-structure/plugins).

```js
import { defineNuxtPlugin } from '#app'

export default defineNuxtPlugin(nuxtApp => {
  nuxtApp.provide('injected', () => 'my injected function')
  // now available on `nuxtApp.$injected`
})
```

::alert
Si vous voulez utiliser les nouveaux composables Nuxt (comme `useNuxtApp` ou `useRuntimeConfig`) dans vos plugins, vous devrez utiliser l'aide `defineNuxtPlugin` pour ces plugins.
: :

## Nouveau `useMeta` (optionnel)

Nuxt Bridge fournit une nouvelle API m√©ta Nuxt 3 qui peut √™tre acc√©d√©e avec un nouveau composable `useMeta`.

```vue
<script setup>
import { useMeta } from '#app'
useMeta({
  title: 'My Nuxt App',
})
</script>
```

Vous devrez √©galement activer cette fonctionnalit√© explicitement dans votre `nuxt.config` :

```js
import { defineNuxtConfig } from '@nuxt/bridge'

export default defineNuxtConfig({
  bridge: {
    meta: true
  }
})
```

Ce composable `useMeta` utilise `@vueuse/head` sous le capot (plut√¥t que `vue-meta`) pour manipuler votre `<head>`.
Par cons√©quent, il est recommand√© de ne pas utiliser √† la fois les propri√©t√©s natives `head()` de Nuxt 2 ainsi que `useMeta`, car elles peuvent entrer en conflit.

Pour plus d'informations sur la fa√ßon d'utiliser ce composable, voir [la docs](/docs/usage/meta-tags#usemeta-composable).

## Drapeaux de fonctionnalit√©s

Vous pouvez optionnellement d√©sactiver certaines fonctionnalit√©s de Bridge ou opter pour des fonctionnalit√©s moins stables. Dans des circonstances normales, il est toujours pr√©f√©rable de s'en tenir aux valeurs par d√©faut !

Vous pouvez v√©rifier [bridge/src/module.ts](https://github.com/nuxt/framework/blob/main/packages/bridge/src/module.ts) pour les derniers param√®tres par d√©faut.

```ts [nuxt.config.js|ts]
import { defineNuxtConfig } from '@nuxt/bridge'

export default defineNuxtConfig({
  bridge: {

    // -- Caract√©ristiques de l'opt-in --

    // Utiliser Vite comme bundler au lieu de Webpack 4
    // vite : true,

    // Activer la compatibilit√© Nuxt 3 useMeta
    // meta : true,

    // -- Caract√©ristiques par d√©faut --

    // Utiliser le serveur h√©rit√© au lieu de Nitro
    // nitro : false,

    // D√©sactiver l'interface `nuxtApp` compatible Nuxt 3
    // app : false,

    // D√©sactive le support de l'API de composition
    // capi : false,

    // Ne pas transpiler les modules
    // transpile : false,

    // D√©sactiver le support de <script setup>.
    // scriptSetup : false,

    // D√©sactiver l'importation automatique des composables
    // autoImports : false,

    // Ne pas avertir des incompatibilit√©s de modules
    // constraints : false
  },

  vite: {
    // Config for Vite
  }
})
```
