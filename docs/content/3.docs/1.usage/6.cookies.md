# Cookies

Nuxt fournit un composable convivial SSR pour lire et √©crire les cookies.

## Utilisation

Dans vos pages, composants et plugins, vous pouvez utiliser `useCookie` pour cr√©er une r√©f√©rence r√©active li√©e √† un cookie sp√©cifique.

```js
const cookie = useCookie(name, options)
```

::alert{icon=üëâ}
**`useCookie` ne fonctionne que pendant `setup` ou `Lifecycle Hooks`**.
::

::alert{icon=üòå}
La r√©f√©rence `useCookie` s√©rialise et d√©s√©rialise automatiquement la valeur du cookie en JSON.
::

## Exemple

L'exemple ci-dessous cr√©e un cookie appel√© `counter`. Si le cookie n'existe pas, il est initialement d√©fini √† une valeur al√©atoire. Chaque fois que nous mettons √† jour la variable `counter`, le cookie sera mis √† jour en cons√©quence.

```vue
<template>
  <div>
    <h1> Counter: {{ counter || '-' }}</h1>
    <button @click="counter = null">
      reset
    </button>
    <button @click="counter--">
      -
    </button>
    <button @click="counter++">
      +
    </button>
  </div>
</template>

<script setup>
const counter = useCookie('counter')
counter.value = counter.value || Math.round(Math.random() * 1000)
</script>
```

:button-link [Ouvrir sur StackBlitz]{href="https://stackblitz.com/github/nuxt/framework/tree/main/examples/use-cookie?terminal=dev" blank}

## Options

Cookie composable accepte plusieurs options qui vous permettent de modifier le comportement des cookies.

La plupart de ces options seront directement pass√©es au paquet [cookie](https://github.com/jshttp/cookie).

### `maxAge' / `expires'.

**`maxAge`** Sp√©cifie le `nombre` (en secondes) qui sera la valeur de l'attribut [`Max-Age` `Set-Cookie`](https://tools.ietf.org/html/rfc6265#section-5.2.2).
Le nombre donn√© sera converti en un nombre entier en l'arrondissant √† l'inf√©rieur. Par d√©faut, aucun √¢ge maximal n'est d√©fini.

**`expires`** : Sp√©cifie l'objet `Date` comme valeur pour l'attribut [`Expires` `Set-Cookie`](https://tools.ietf.org/html/rfc6265#section-5.2.1).
Par d√©faut, aucune expiration n'est d√©finie. La plupart des clients consid√©reront qu'il s'agit d'un "cookie non persistant" et
l'effaceront √† une condition telle que la sortie d'une application de navigateur Web.

::alert{icon=üí°}
**Note:** La [sp√©cification du mod√®le de stockage des cookies](https://tools.ietf.org/html/rfc6265#section-5.3) stipule que si les deux param√®tres `expires` et
`maxAge` sont d√©finies, alors `maxAge` a la priorit√©, mais tous les clients n'ob√©issent pas forc√©ment √† cette r√®gle,
donc si les deux sont d√©finis, ils doivent pointer vers la m√™me date et heure !
::

::alert
Si ni `expires` ni `maxAge` ne sont d√©finis, le cookie ne sera valable que pour la session et sera supprim√© lorsque l'utilisateur fermera son navigateur.
::

### `httpOnly`

Sp√©cifie la valeur "bool√©enne" de l'attribut [`HttpOnly` `Set-Cookie`] (https://tools.ietf.org/html/rfc6265#section-5.2.6). Lorsqu'il est vrai,
l'attribut `HttpOnly` est d√©fini, sinon il ne l'est pas. Par d√©faut, l'attribut `HttpOnly` n'est pas d√©fini.

::alert{icon=üí°}
**Note:** Soyez prudent lorsque vous d√©finissez cet attribut √† `true`, car les clients conformes n'autoriseront pas le JavaScript c√¥t√© client √† voir le cookie dans le champ ``Value``.
JavaScript c√¥t√© client de voir le cookie dans `document.cookie`.
::

### `secure`

Sp√©cifie la valeur "bool√©enne" de l'attribut [`Secure` `Set-Cookie`] (https://tools.ietf.org/html/rfc6265#section-5.2.5). Lorsqu'il est vrai,
l'attribut `Secure` est activ√©, sinon il ne l'est pas. Par d√©faut, l'attribut `Secure` n'est pas d√©fini.

::alert{icon=üí°}
**Note:** Soyez prudent lorsque vous d√©finissez cette option √† `true`, car les clients conformes ne renverront pas le cookie au serveur √† l'avenir si le navigateur n'a pas de connexion HTTPS.
le cookie au serveur √† l'avenir si le navigateur ne dispose pas d'une connexion HTTPS. Cela peut conduire √† des erreurs d'hydratation.
::

### `domaine`

Sp√©cifie la valeur de l'attribut [`Domaine` `Set-Cookie`] (https://tools.ietf.org/html/rfc6265#section-5.2.3). Par d√©faut, aucun
domaine n'est d√©fini, et la plupart des clients consid√©reront que le cookie ne s'applique qu'au domaine actuel.

### `path`

Sp√©cifie la valeur de l'attribut [`Path` `Set-Cookie`] (https://tools.ietf.org/html/rfc6265#section-5.2.4). Par d√©faut, le chemin
est consid√©r√© comme le ["chemin par d√©faut"](https://tools.ietf.org/html/rfc6265#section-5.1.4).

### `sameSite`

Sp√©cifie la valeur `boolean` ou `string` pour l'attribut [`SameSite` `Set-Cookie`](https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03#section-4.1.2.7).

- `true` d√©finira l'attribut `SameSite` avec la valeur `Strict` pour une application stricte du principe du m√™me site.
- `false` ne d√©finira pas l'attribut `SameSite`.
- `'lax'` donnera √† l'attribut `SameSite` la valeur `Lax` pour une application laxiste de la loi sur les sites identiques.
- `'none'` mettra l'attribut `SameSite` √† `None` pour un cookie intersite explicite.
- `'strict'` mettra l'attribut `SameSite` √† `Strict` pour une application stricte du m√™me site.

Vous trouverez de plus amples informations sur les diff√©rents niveaux d'application dans [the specification](https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03#section-4.1.2.7).

### `encode`

Sp√©cifie une fonction qui sera utilis√©e pour encoder la valeur d'un cookie. Comme la valeur d'un cookie
a un jeu de caract√®res limit√© (et doit √™tre une cha√Æne simple), cette fonction peut √™tre utilis√©e pour coder une valeur en une cha√Æne adapt√©e √† la valeur d'un cookie.
une valeur dans une cha√Æne adapt√©e √† la valeur d'un cookie.

L'encodeur par d√©faut est le `JSON.stringify` + `encodeURIComponent`.

### `decode`

Sp√©cifie une fonction qui sera utilis√©e pour d√©coder la valeur d'un cookie. Puisque la valeur d'un cookie
a un jeu de caract√®res limit√© (et doit √™tre une cha√Æne simple), cette fonction peut √™tre utilis√©e pour d√©coder
une valeur de cookie pr√©c√©demment cod√©e en une cha√Æne JavaScript ou un autre objet.

Le d√©codeur par d√©faut est `decodeURIComponent` + [destr](https://github.com/unjs/destr).

::alert{icon=üí°}
**Note:** Si une erreur est g√©n√©r√©e par cette fonction, la valeur originale du cookie, non d√©cod√©e
sera retourn√©e comme valeur du cookie.
::

## Gestion des cookies dans les routes API

Vous pouvez utiliser `useCookie` et `setCookie` du paquet [`h3`](https://github.com/unjs/h3) pour d√©finir les cookies dans les routes API du serveur.

**Exemple:**

```js
import { useCookie, setCookie } from 'h3'

export default (req, res) => {
  // Lire le cookie du compteur
  let counter = useCookie(req, 'counter') || 0

  // Augmente le cookie du compteur de 1
  setCookie(res, 'counter', ++counter)

  // Envoyer la r√©ponse JSON
  return { counter }
}
```
